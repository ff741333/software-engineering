<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>仓库</title>
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/test.css">
    <script src="../layui/layui.js" charset="UTF-8"></script>
</head>
<body>


<div >               
                <div id="guide_panel">
    <blockquote class="layui-elem-quote">
            <h2 >菜品列表</h2>
            <div class="demoTable">
                                                           搜索菜名：
            <div class="layui-inline">
             <input class="layui-input" name="id" id="demoReload" autocomplete="off">
            </div>
            <button class="layui-btn" data-type="reload">搜索</button>
            <button class="layui-btn layui-btn-normal" data-type="food" >添加蔬肉</button>
            </div>          
    </blockquote>

</div>
        <table id="List1" lay-filter="List1"></table>
</div>

</body>

<script>
layui.use(['table','layer'], function(){
  var table = layui.table;
  var layer = layui.layer;
  var $ = layui.$;
  

  /*
   * 数据表格:定义表头数据
   * @type {{}}
   */
  var lan = {};
  lan.cpbm = "菜品编号";
  lan.cpmc = "菜品名称";
  lan.ckjj = "价格";
  lan.spbh = "菜品编号";
  lan.spmc = "菜品名称";
  lan.sl = "数量";
  lan.dj = "单价";
  lan.je = "金额";
  lan.cz = "操作";
  /**
   *得到数据库中food表的数据
   * showfood是servlet
   */
  /**
 
  var goodsData = [];
  /**
   * 页面加载时执行
   */
  $(function () {
    //  console.table(GoodsData);
   
      /**
       * List1数据表格渲染(商品列表)
       */

      var ListTable1 = table.render({
    	  id:'reload',  //重载id
    	  url:'../showfood2',
        //  data:GoodsData,
          elem: '#List1',
          cellMinWidth: 95,
          //height: 'full-190',
          height: '460',
          minheight:430,
          page: false,
          cols: [
              [
                  { hide:true,field: 'FoodsID', title: lan.cpbm, align: 'left' },
                  { hide:true,field: 'FoodsImg', title: '图片', align: 'left' },
                  { field: 'FoodsName', title: lan.cpmc, align: 'left' },
                  {
                    field: 'XPrice', title: lan.ckjj, align: 'right', templet: function (d) {
                          return "<span style='color:red'>￥" + d.XPrice + "</span>";
                      }
                  },
                  {
                      field: 'Xnum', title: lan.sl, align: 'right', templet: function (d) {
                    	  if(d.Xnum<=10)
                            return "<span style='color:red'>" + d.Xnum + "</span>";
                            else 
                            	return d.Xnum;
                        }
                    },
              ]
          ],
          initSort: {
        	    field: 'Xnum' //排序字段，对应 cols 设定的各字段名
        	    ,type: 'asc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
        	  }
      });
 

  
  //监听行单击事件（双击事件为：rowDouble）
  table.on('row(List1)', function(obj){
    var data = obj.data;
    var imgstr = null;

    layer.open({
        type: 1
        ,title: false //不显示标题栏
        ,closeBtn: false
      //  ,area:['600px','700px']
        ,shade: 0.8
        ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
        ,btn: ['入库', '删除','取消']
        ,btnAlign: 'c'
        ,moveType: 1 //拖拽模式，0或者1
        ,content: '<div id= "show"style="padding: 10px; line-height: 22px; background-color: #F0F0F0; font-weight: 700;"><img width=330 height=270 src="../images/foods/'+data.FoodsImg+'" alt="1"><ul class="layui-timeline"><li class="layui-timeline-item"><i class="layui-icon layui-timeline-axis"></i><div class="layui-timeline-content layui-text"><h3 id = "title" class="layui-timeline-title">'+data.FoodsName+'</h3><p>这是个好菜！</p></div></li></ul><div class="layui-footer footer"><form class="layui-form layui-row" name="numform"><div class="layui-col-md12 layui-col-xs12"><div class="layui-form-item"><label class="layui-form-label"><h3>数量</h3></label><div class="layui-input-block"><input type="text" placeholder="1" class="layui-input" name="num" id="num"></div></div></div><div class="layui-col-md12 layui-col-xs12"><div class="layui-form-item"><label class="layui-form-label"><h3>入库单价</h3></label><div class="layui-input-block"><input type="text" placeholder="请输入单价" class="layui-input" name="price" id="price"></div></div></div></form></div></div>'//'<div style="padding: 10px; line-height: 22px; background-color: #393D49; color: #fff; font-weight: 700;"><img src="../images/userface1.jpg" alt="1"></div>'
        ,success: function(layero,index){
        	//changeHtml();
   

        }
        ,yes: function(){
        	var num;
        	var price;
        	if($("#num").val()=="")num=1;
        	else num=$("#num").val();
        	if($("#price").val()=="") layer.alert("请输入单价");
        	else {
        		price=$("#price").val();
        	 $.ajax({
                 url:'../store',
                 type:'post',
                 dataType:'text',
                 data:{
                     Id:data.FoodsID,
                     num:num,
                     price:price
                 },
                 success:function(data){
                 	if(data == 1){
                 		
                 		ListTable1.reload({ url: '../showfood2' });
                        layer.closeAll();
	                        layer.msg("入库成功！");
	                        }
                 	}
                 });
        	}


           	
      }
      ,btn2: function(){
       //删除按钮
    	  $.ajax({
              url:'../deletefood',
              type:'post',
              dataType:'text',
              data:{
                  Id:data.FoodsID,
              },
              success:function(data){
              	if(data == 1){
              		
              		ListTable1.reload({ url: '../showfood2' });
                     layer.closeAll();
	                        layer.msg("删除成功！");
	                        }
              	}
              });
      }
        ,cancel: function(){ 
            //右上角关闭回调
            
            //return false 开启该代码可禁止点击该按钮关闭
         }
        ,closeBtn:2
      });
    //标注选中样式
   // obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
  });
  
  //查询菜品表
  $ , active = {
		    reload: function(){
		      var demoReload = $('#demoReload');
		      
		      //执行重载
		      table.reload('reload', {
		        page: {
		          curr: 1 //重新从第 1 页开始
		        }
		        ,where: {
		        	key: {
		                FoodName: demoReload.val()
		              }
		        }
		      }, 'data');
		    },
           food:function(){
        	    layer.open({
        	        type: 2
        	        ,title: false //不显示标题栏
        	        ,closeBtn: false
        	        ,area:['400px','500px']
        	        ,shade: 0.8
        	        ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
        	        ,closeBtn:1
        	        ,btnAlign: 'c'
        	        ,moveType: 1 //拖拽模式，0或者1
        	        ,content:"addfood.html"
                    ,success: function(layero,index){
        	        	//changeHtml();       	  
        	        }
        	        ,cancel: function(index, layero){ 
                		ListTable1.reload({ url: '../showfood2' });
                        layer.closeAll();
        	        		  return false; 
        	        		}    
        	    });

           }
  };
		  
	$('.demoTable .layui-btn').on('click', function(){
		    var type = $(this).data('type');
		    active[type] ? active[type].call(this) : '';
		  });
  });
});

</script>

</html>